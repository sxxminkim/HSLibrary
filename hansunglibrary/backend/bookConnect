const express = require ('express');
const mysql = require ('mysql2/promise');
const cors = require ('cors');
const app=express();
app.use(cors());
app.use(express.json());
const pool=mysql.createPool({
    host : 'hslibrary.cxnldqrql9ej.ap-southeast-2.rds.amazonaws.com',
    user : 'admin',
    password : 'hslibrary',
    database : 'hslibrary',
    port : 3306,
    waitForConnections : true,
    connectionLimit : 10,
    queueLimit : 0
})
app.get('/book',async(req,res)=>{
    try{
        const connection = await pool.getConnection();
        const [rows, fields]= await connection.execute('SELECT * FROM book');
        connection.release();
        res.status(200).send(rows);
    }catch(err){
        console.error(err);
        res.status(500).send('Error retrieving book.');
    }finally{
        //connection 닫아주는 부분
        if(connection){
            try{
                await connection.release();
            }
            catch(err){
                console.error(err);
            }
        }
    }
})